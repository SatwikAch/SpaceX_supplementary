[["index.html", "Supplementary Materials for Gene Co-expression Network Estimation in Spatial Transcriptomics Introduction", " Supplementary Materials for Gene Co-expression Network Estimation in Spatial Transcriptomics Satwik Acharyya, Xiang Zhou, Veera Baladandayuthapani 2021-11-22 Introduction The spatial transcriptomics method depicts the positioning of a single cell on a spatially structured tissue. Knowledge about gene expressions and the spatial distribution of mRNA allows us to uncover cellular and subcellular heterogeneity in tissues, tumors, and immune cells. Spatial transcriptomics provides a unique opportunity to decipher both the cellular and subcellular architecture in both tissues and individual cells along with detection of gene co-expression patterns at both levels. These approaches are very insightful to study disease propagation in the field of embryology, oncology, and histology. The SpaceX method is a statistical tool to quantify spatially varying gene co-expression patterns in a tissue consists of different cell type based or sptailly contiguous clusters. This is a supplementary file of the paper named SpaceX: Gene Co-expression Network Estimation in Spatial Transcriptomics. The sectional contents of the supplementary file is mentioned below. We start with a detailed description of the methodology in section A. In section B, further details of simulation study have been discussed. Eploratory analysis and more findings of real data analysis have been laid out in section C. Finally, we discuss the detailed steps for implementation of the SpaceX package in section D. "],["method.html", "A Methodology A.1 Poisson Mixed Model A.2 Multi-Study Factor Model (MSFA) A.3 Multiplicative gamma shrinkage prior", " A Methodology In this section, we provide a detailed discussion of the estimation procedure for the SpaceX model equation 1 in section 2.1 of the paper. A full-scale MCMC will be computationally expensive on a complex hierarchical model. For computational advantage, we decompose the model into two parts (I) sPMM: spatial Poisson mixed model (Sun et al. 2017) and (II) MSFA: Multi-study factor analysis model (De Vito et al. 2018). We enable this model decomposition through a standard Gaussian random variable. A.1 Poisson Mixed Model We can break the SpaceX model and write the spatial Poisson mixed model as \\[\\begin{align} \\begin{split} &amp; \\text{log}({\\boldsymbol \\lambda}^{c}_{g}) = {{\\bf X}^{c}}^{T} {\\boldsymbol \\beta}^{c}_{g} + {\\bf s}^{c} + {\\bf z}^{c}_{g}, \\\\ &amp; {\\boldsymbol \\lambda}^{c}_{g} = ( \\lambda^{c}_{1g}, \\dots , \\lambda^{c}_{N_{c}g} )^{T}, \\\\ &amp;{\\bf s}^{c} = ( s^{c}_{1}, \\dots , s^{c}_{N_{c}} )^{T} \\sim \\text{MVN}(0, \\sigma_{1}^{2}\\Omega^{c}(s)), \\\\ &amp;{\\bf z}^{c}_{g} = (z^{1}_{1g}, \\dots , z^{c}_{N_{c}g})^{T} \\sim \\text{MVN}(0, \\sigma_{2}^{2} I_{N_{c} \\times N_{c} }). \\end{split} \\tag{A.1} \\end{align}\\] Here \\(\\Omega^{c}(s_{1}, s_{2}) = \\text{exp} (- \\mid \\mid s_{1} - s_{2} \\mid \\mid^{2} / 2 \\rho^{2}_{c} ),\\) \\(c = 1, \\dots, C\\). We estimate the length scale parameter of spatial kernel \\(\\rho_{c}\\) based on the steps discussed in section 1 of supplementary information in Sun et al. (2017). Here \\(Z^{c}_{g}\\) captures the cluster specific latent gene expressions and a multi-variate hierarchical modeling of \\(Z^{c}_{g}(s_{i})\\) will help us to identify the gene co-expression network. A.2 Multi-Study Factor Model (MSFA) The 2nd stage of the modeling framework is multi-study factor analysis (De Vito et al. 2018) which is provided as follows \\[\\begin{align} \\begin{split} &amp; \\hat{\\bf z}^{c}_{i} = \\boldsymbol \\Phi {\\bf f}_{i} + \\boldsymbol \\Psi^{c} {\\bf d}^{c}_{i} + {\\bf e}^{c}_{i}, \\\\ &amp; {\\bf f}_{i} \\sim N_{K}(0, {\\bf I}_{K}), \\hspace{0.5cm} {\\bf d}^{c}_{i} \\sim N_{K_{c}}(0,{\\bf I}_{K_{c}}),\\\\ &amp; {\\bf e}^{c}_{i} \\sim N_{G}(0,\\boldsymbol \\Xi_{c}), \\hspace{0.5cm} \\boldsymbol \\Xi_{c} = \\text{diag}(\\xi^{c}_{1}, \\dots, \\xi^{c}_{G} ). \\end{split} \\tag{A.2} \\end{align}\\] The marginal distribution of \\(\\hat{\\bf z}^{c}_{i}\\) is a multivariate normal distribution with mean \\(0\\) and covariance matrix \\(\\Sigma_{c}\\) s.t. \\[\\begin{align} \\Sigma_{c} = \\Phi \\Phi^{T} + \\Psi^{c} {\\Psi^{c}}^{T} + \\Xi_{c} = \\Sigma_{\\Phi} + \\Sigma_{\\Psi^{c}} + \\Xi_{c} \\tag{A.3} \\end{align}\\] \\(\\Sigma_{\\Phi} = \\Phi \\Phi^{T}\\) and \\(\\Sigma_{\\Psi^{c}} = \\Psi^{c} {\\Psi^{c}}^{T}\\) are covariance of shared and cluster specific factors respectively. The decomposition of \\(\\Sigma_{c}\\) in (A.3) is not a unique since we can set \\(\\Phi^{*} = \\Phi Q\\) and \\({\\Psi^{*}}^{c} = \\Psi^{c} Q_{c}\\) where \\(Q\\) and \\(Q_{c}\\) are square orthonormal matrices. This will also lead to the same decomposition \\(\\Sigma^{c} = \\Phi^{*} {\\Phi^{*}}^{T} + {\\Psi^{*}}^{c} {{\\Psi^{*}}^{c}}^{T} = \\Phi \\Phi^{T} + \\Psi_{c} \\Psi_{c}^{T}\\). To overcome the indeterminacy through orthonormal matrices, the factor loading matrices are restricted to be lower triangular matrices (Geweke and Zhou 1996; Lopes and West 2004). A.3 Multiplicative gamma shrinkage prior We follow the same steps from De Vito et al. (2018) and place multiplicative gamma shrinkage prior (Bhattacharya and Dunson 2011) prior on the shared and cluster specific loading matrices i.e. \\(\\Phi\\) and \\(\\Psi_{c}\\) \\(c=1,\\dots,C\\). The shared and cluster specific latent factors (\\(K\\) and \\(K_{c}\\) respectively) are selected following methodology described in section 3.3 of De Vito et al. (2018). The multiplicative gamma prior on elements of shared covariance matrices are provided as follows \\[\\begin{equation} \\begin{split} &amp; \\phi_{gk} \\mid \\delta_{gk}, \\eta_{k} \\sim N(0, \\delta_{gk}^{-1} \\eta_{k}^{-1}), \\hspace{0.5cm} g = 1, \\dots , G, \\hspace{0.25cm} k = 1, \\dots, \\infty, \\\\ &amp; \\delta_{gk} \\sim \\Gamma(\\frac{\\nu}{2}, \\frac{\\nu}{2}) \\hspace{0.5cm} \\eta_{k} = \\prod_{j=1}^{k} \\zeta_{j} \\hspace{0.5cm} \\zeta_{1} \\sim \\Gamma(a_{1},1) \\hspace{0.5cm} \\zeta_{j} \\sim \\Gamma(a_{2},1), \\hspace{0.2cm} j \\ge 2. \\end{split} \\end{equation}\\] Here \\(\\delta_{gk}\\) is the local shrinkage parameter for \\(G\\) column elements of \\(k\\)th column and \\(\\eta_{k}\\) is the global shrinkage parameter where \\(\\zeta_{j}\\) \\((j=1,2. \\dots)\\) are independent. We repeat the same process to posit prior on the elements of cluster-specific loading matrices \\[\\begin{equation} \\begin{split} &amp; \\psi^{c}_{gk_{c}} \\mid \\delta^{c}_{gk_{c}}, \\eta^{c}_{k_{c}} \\sim N(0, {\\delta^{c^{-1}}_{gk_{c}}} {\\eta^{c^{-1}}_{k_{c}}}), \\hspace{0.5cm} g = 1, \\dots , G, \\hspace{0.2cm} k_{c} = 1, \\dots, \\infty \\hspace{0.2cm} \\text{and} \\hspace{0.2cm} c = 1, \\dots , C,\\\\ &amp; \\delta^{c}_{gk_{c}} \\sim \\Gamma(\\frac{\\nu^{c}}{2}, \\frac{\\nu^{c}}{2}) \\hspace{0.5cm} \\eta^{c}_{k_{c}} = \\prod_{j=1}^{k_{c}} \\zeta^{c}_{j} \\hspace{0.5cm} \\zeta^{c}_{1} \\sim \\Gamma(a^{c}_{1},1) \\hspace{0.5cm} \\zeta^{c}_{j} \\sim \\Gamma(a^{c}_{2},1), \\hspace{0.2cm} j \\ge 2. \\end{split} \\end{equation}\\] Here \\(\\delta^{c}_{gk_{c}}\\) \\(\\eta^{c}_{k_{c}}\\) are local and global parameters respectively and \\(\\zeta_{j}^{c}\\) \\((c=1,2, \\dots C)\\) are independent of each other. We determine \\(K\\) and \\(K_{c}\\) following methodology described in section 3.3 of De Vito et al. (2018). References "],["simulation.html", "B Simulation Study B.1 Induced Correlation Study B.2 Comparative analysis with different norm measures B.3 Estimation of latent factors", " B Simulation Study B.1 Induced Correlation Study In this section, we provide more details about the simulation study. First we consider \\(3\\) different values of \\(\\rho\\) \\((0.1,0.15,0.2)\\) and make a induced correlation plot by using the squared exponential spatial kernel. The plots are generented for all cell types and cell type specific cases. The vertical line denotes the value of induced correlation at the distance \\(0.01\\). For example the induced spatial correlations for all cell types (first figure of B.1) w.r.t. \\(0.01\\) distance are \\(0.88\\), \\(0.80\\), \\(0.61\\) for \\(\\text S_{\\text High}\\) (\\(\\rho = 0.2\\)), \\(\\text S_{\\text Med}\\) (\\(\\rho = 0.15\\)), \\(\\text S_{\\text Low}\\) (\\(\\rho = 0.1\\)) methods respectively. Figure B.1: Induced correlation plot for the Merfish data B.2 Comparative analysis with different norm measures We consider the simulation setting discussed in the section 3 of the manuscript. The \\(5\\) different methods are compared w.r.t. different norms other than RV coefficent (Robert and Escoufier 1976). The RV coefficent between two matrices \\(S_{1}\\) and \\(S_{2}\\) is defined as \\[\\text{RV}(S_{1},S_{2}) = \\frac{ tr( S_{1}^{T} S_{2} ) }{ \\sqrt{ tr( S_{1}^{T} S_{1} ) tr( S_{2}^{T} S_{2} ) } }.\\] We consider 4 different norms: I. Euclidean or Frobenius \\[ d_{E}(S_{1},S_{2}) = \\mid \\mid S_{1} - S_{2} \\mid \\mid, \\] II. Log-Euclidean \\[ d_{L}(S_{1},S_{2}) = \\mid \\mid \\log(S_{1}) - \\log(S_{2}) \\mid \\mid, \\] III. Root Euclidean \\[ d_{H}(S_{1},S_{2}) = \\mid \\mid S_{1}^{1/2} - S_{2}^{1/2} \\mid \\mid, \\] Riemanian \\[ d_{R}(S_{1},S_{2}) = \\mid \\mid S_{1}^{-1/2} S_{2} S_{1}^{-1/2} \\mid \\mid. \\] Figure B.2, B.3, B.4 and B.5 are boxplot of distances between true \\((\\Sigma_{True})\\) and estimated \\((\\Sigma_{Est})\\) covariance matrices where the distances are measured in Euclidean, root Euclidean, log Euclidean and Riemanian norms (Dryden et al. 2009) respectively. In all the norms we observe that spatial settings are performing better in terms of estimation than the no-spatial settings. Among the spatial settings the estimation accuracy increase with an increment in induced spatial correlation. Figure B.2: Boxplot of Euclidean distance \\(d_E(\\Sigma_{True}, \\Sigma_{Est})\\) across \\(50\\) replicates for \\(\\Sigma_{\\Phi} = \\Phi \\Phi^{T}\\) and \\(\\Sigma_{l}\\) \\((l = 1, \\dots , L)\\). We compare the Euclidean distance for different method settings. Figure B.3: Boxplot of root Euclidean distance \\(d_{H}(\\Sigma_{True}, \\Sigma_{Est})\\) across \\(50\\) replicates for \\(\\Sigma_{\\Phi} = \\Phi \\Phi^{T}\\) and \\(\\Sigma_{l}\\) \\((l = 1, \\dots , L)\\). We compare the root Euclidean distance for different method settings. Figure B.4: Boxplot of log Euclidean distance \\(d_{L}( \\Sigma_{True}, \\Sigma_{Est})\\) across \\(50\\) replicates for \\(\\Sigma_{\\Phi} = \\Phi \\Phi^{T}\\) and \\(\\Sigma_{l}\\) \\((l = 1, \\dots , L)\\). We compare the log Euclidean distance for different method settings. Figure B.5: Boxplot of Riemanian distance \\(d_{R}( \\Sigma_{True}, \\Sigma_{Est})\\) across \\(50\\) replicates for \\(\\Sigma_{\\Phi} = \\Phi \\Phi^{T}\\) and \\(\\Sigma_{l}\\) \\((l = 1, \\dots , L)\\). We compare the Riemanian distance for different method settings. B.3 Estimation of latent factors We follow same procedure from section 3.3 of De Vito et al. (2018) to estimate shared and cluster specific number of factors i.e. \\(K\\) and \\(K_{c}\\) \\((c=1,2, \\dots C)\\). Figure B.6 shows shared and cluster specfic estimated factor loadings accross \\(50\\) replicates for \\(5\\) different methods. Figure B.7 shows the median estimate of shared and cluster specfic factor loadings for \\(5\\) different methods. From both figures one can observe that spatial settings are estimating the loadings more precisely than the non-spatial settings. Figure B.6: Estimated dimension of factor loadings for shared and cluster specific cases accross \\(50\\) replicates. Black solid line denotes the true dimensions. Figure B.7: Estimated Factor loadings with credible intervals. References "],["realdata.html", "C Real Data Analysis C.1 Exploratory analysis of the datasets C.2 Community detection C.3 List of hub genes and edges", " C Real Data Analysis We applied the SpaceX method on two spatial transcriptomics datasets which are obtained from the preoptic region of the mouse hypothalamus (Moffitt et al. 2018) and the human breast cancer dataset (Ståhl et al. 2016). Here we provide details of preprocessing and exploratory analysis of both datasets in section C.1. We illustrate the detailed application of the community detection algorithm on those two datasets in section C.2. C.1 Exploratory analysis of the datasets C.1.1 Merfish Data The MERFISH dataset is obtained from the preoptic area of the mouse hypothalamus (Moffitt et al. 2018). The dataset consists of \\(160\\) genes and corresponding gene expressions are measured in \\(4975\\) spatial locations. There are \\(7\\) pre-determined spatial clusters in the dataset named Astrocyte, Endothelial, Ependymal, Excitatory, Inhibitory, Immature, Mature, and the corresponding sizes are \\(724\\), \\(503\\), \\(314\\), \\(1024\\), \\(1694\\), \\(168\\), \\(385\\) respectively. The dataset consists of \\(2\\) more clusters named Microglia, Pericytes with cluster sizes \\(90\\), \\(73\\) respectively which are less than \\(100\\). Those two clusters are removed from the dataset. After removing those two clusters, we have gene expressions from \\(4812\\) locations corresponding to \\(160\\) genes. There are no genes with more than \\(95\\%\\) zeros reads. The left panel of Figure C.1 shows the violin plot of the percentage of zero reads among the genes for each cluster in the MERFISH dataset. The Umap representation of the Merfish data has been provided on the right panel of Figure C.1. Figure C.1: Left panel shows the violin plot of percentage of zero reads among the genes for each cluster w.r.t. Merfish data and the right panel shows the Umap. C.1.2 Breast Cancer Data The human breast cancer dataset contains expression levels from \\(5262\\) genes measured at \\(250\\) locations (Ståhl et al. 2016). We use the SPARK method with \\(5\\%\\) FDR cut-off on p-values to detect \\(290\\) spatially expressed genes to carry forward our analysis. The violin plot of the percentage of zero reads among the genes for each spatially contiguous cluster in the Breast cancer dataset is shown in the left panel of Figure C.2. On the right panel of Figure C.2, we have provided the Umap. Figure C.2: On the left panel, we have violin plot of percentage of zero reads among the genes for each cluster w.r.t. Breast Cancer data and the Umap is shown on the right panel. C.2 Community detection The community detection is a downstream analysis of the shared and cluster-specific networks which are obtained from the SpaceX method. The communities are detected by optimizing modularity over partitions in a network structure (Brandes et al. 2007). Figure C.3 and C.4 show the detected community modules from shared and cluster-specific co-expression networks for MERFISH and breast cancer data respectively. Figure C.3: Shared and cell-type specific community detection for Merfish data Figure C.4: Shared and cell-type specific community detection for Breast cancer data C.3 List of hub genes and edges A detailed list of hub genes and top edges for both the datasets can be found at https://github.com/SatwikAch/SpaceX. References "],["ImplementSpaceX.html", "D Implementation of SpaceX D.1 Installation D.2 Data inputs D.3 Output D.4 Example", " D Implementation of SpaceX SpaceX function extimates shared and cluster specfic gene co-expression networks for spatial transcriptomics data. More details about the SpaceX method can be found in the main manuscript. See below for detailed discussion on installation of SpaceX package, Data inputs and outputs followed by an example. D.1 Installation You can install the released version of SpaceX from (https://github.com/SatwikAch/SpaceX) with: devtools::install_github(&quot;SatwikAch/SpaceX&quot;) library(SpaceX) D.2 Data inputs Please make sure to provide both inputs as dataframe. The first input is Gene_expression_mat which is \\(N \\times G\\) dataframe. Here \\(N\\) denotes the number of spatial locations and \\(G\\) denotes number of genes. The second input is Spatial_locations is a dataframe which contains spatial coordinates. The third input is Cluster_annotations. D.3 Output You will obtain a list of objects as output. SigmaPhi denotes the Shared Covariance matrix i.e. \\(\\Sigma_{\\Phi} = \\Phi \\Phi^{T}\\). SigmaLambda denotes the cluster specific Covaraince matrices i.e. \\(\\Sigma_{\\Psi^{c}} = \\Psi^{c} {\\Psi^{c}}^{T}\\). D.4 Example Here we provide an example to run the SpaceX method. # Reading the Breast cancer data # Spatial locations head(BC_loc) # Gene expression for data head(BC_count) # Data processing G &lt;-dim(BC_count)[2] # number of genes N &lt;-dim(BC_count)[1] # number of locations Next, we’ll apply the SpaceX method on the Breast cancer dataset. # Application to SpaceX method BC_fit &lt;- SpaceX(BC_count,BC_loc[,1:2],BC_loc[,3]) # SigmaPhi :: Shared Covariance matrix # SigmaLambda :: Cluster specific Covaraince matrices "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
